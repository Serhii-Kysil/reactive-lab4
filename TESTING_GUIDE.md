# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ Spring Security

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –¥–æ–¥–∞—Ç–∫—É

```cmd
mvnw.cmd spring-boot:run
```

–ó–∞—á–µ–∫–∞–π—Ç–µ –ø–æ–∫–∏ –Ω–µ –ø–æ–±–∞—á–∏—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
```
Started ReactorApplication in X.XXX seconds
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ

#### –¢–µ—Å—Ç 1: –ü—É–±–ª—ñ—á–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ: http://localhost:8080/
2. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `"Hello World!"`
3. **–°—Ç–∞—Ç—É—Å:** –î–æ—Å—Ç—É–ø –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

#### –¢–µ—Å—Ç 2: –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ /users
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ: http://localhost:8080/users
2. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Ñ–æ—Ä–º—É –ª–æ–≥—ñ–Ω—É
3. –í–≤–µ–¥—ñ—Ç—å:
   - Username: `1111`
   - Password: `1111`
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω—É:** `"User Page"`

#### –¢–µ—Å—Ç 3: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ /admin (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á 1111)
1. –ü—ñ—Å–ª—è –≤—Ö–æ–¥—É —è–∫ `1111`, –≤—ñ–¥–∫—Ä–∏–π—Ç–µ: http://localhost:8080/admin
2. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON –º–∞—Å–∏–≤ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏:
```json
[
  {"id":1,"username":"Vasya","password":"1234","authorities":[]},
  {"id":2,"username":"Inna","password":"1234","authorities":[]},
  {"id":3,"username":"Ira","password":"1234","authorities":[]}
]
```

#### –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á 2222)
1. –í–∏–π–¥—ñ—Ç—å –∑ —Å–∏—Å—Ç–µ–º–∏ –∞–±–æ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ —ñ–Ω–∫–æ–≥–Ω—ñ—Ç–æ –≤–∫–ª–∞–¥–∫—É
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞: http://localhost:8080/users
3. –£–≤—ñ–π–¥—ñ—Ç—å —è–∫:
   - Username: `2222`
   - Password: `2222`
4. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `"User Page"` ‚úì
5. –°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏: http://localhost:8080/admin
6. **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `403 Forbidden` –∞–±–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥–º–æ–≤—É –≤ –¥–æ—Å—Ç—É–ø—ñ ‚úì

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ curl (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

#### –ü—É–±–ª—ñ—á–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
```cmd
curl http://localhost:8080/
```

#### –ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é)
```cmd
curl -u 1111:1111 http://localhost:8080/users
```

#### –ê–¥–º—ñ–Ω —Å—Ç–æ—Ä—ñ–Ω–∫–∞
```cmd
curl -u 1111:1111 http://localhost:8080/admin
```

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–º–æ–≤–∏ –≤ –¥–æ—Å—Ç—É–ø—ñ
```cmd
curl -u 2222:2222 http://localhost:8080/admin
```

## –ú–∞—Ç—Ä–∏—Ü—è –¥–æ—Å—Ç—É–ø—É

| –ï–Ω–¥–ø–æ—ñ–Ω—Ç | –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1111 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2222 |
|----------|----------------|----------------|----------------|
| `/` | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ |
| `/registration` | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ |
| `/users` | ‚úó –†–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥—ñ–Ω | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ (ROLE_User) | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ (ROLE_User) |
| `/admin` | ‚úó –†–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥—ñ–Ω | ‚úì –î–æ—Å—Ç—É–ø–Ω–æ (ROLE_Admin) | ‚úó 403 Forbidden |

## –î–∞–Ω—ñ –≤ –±–∞–∑—ñ

### –¢–∞–±–ª–∏—Ü—è `users`
| id | username | password |
|----|----------|----------|
| 1  | 1111     | 1111     |
| 2  | 2222     | 2222     |

### –¢–∞–±–ª–∏—Ü—è `roles`
| id | name |
|----|------|
| 1  | ROLE_User |
| 2  | ROLE_Admin |

### –¢–∞–±–ª–∏—Ü—è `roles_has_users`
| id | user_id | role_id | –û–ø–∏—Å |
|----|---------|---------|------|
| 1  | 1       | 1       | User 1111 –º–∞—î —Ä–æ–ª—å User |
| 2  | 1       | 2       | User 1111 –º–∞—î —Ä–æ–ª—å Admin |
| 3  | 2       | 1       | User 2222 –º–∞—î —Ç—ñ–ª—å–∫–∏ —Ä–æ–ª—å User |

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ –≤ PostgreSQL

```sql
-- –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
psql -U postgres -d text_group4

-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∞–±–ª–∏—Ü—ñ
\dt

-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
SELECT * FROM users;

-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–ª—ñ
SELECT * FROM roles;

-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–≤'—è–∑–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ —Ä–æ–ª–µ–π
SELECT u.username, r.name as role
FROM users u
JOIN roles_has_users rhu ON u.id = rhu.user_id
JOIN roles r ON rhu.role_id = r.id;
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑–∞–ø–∏—Ç—É:**
```
 username |    role
----------+-------------
 1111     | ROLE_User
 1111     | ROLE_Admin
 2222     | ROLE_User
```

## –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ —ñ—Å–Ω—É—î
**–ü–æ–º–∏–ª–∫–∞:** `FATAL: database "text_group4" does not exist`

**–†—ñ—à–µ–Ω–Ω—è:**
```sql
CREATE DATABASE text_group4;
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: IDE –ø–æ–∫–∞–∑—É—î –ø–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó
**–°–∏–º–ø—Ç–æ–º:** –ß–µ—Ä–≤–æ–Ω–µ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è –≤ –∫–ª–∞—Å–∞—Ö Security

**–†—ñ—à–µ–Ω–Ω—è:**
1. File ‚Üí Invalidate Caches ‚Üí Invalidate and Restart
2. –ê–±–æ: Maven ‚Üí Reload Project (–ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –Ω–∞ pom.xml)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ú—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–µ –≤–∏–∫–æ–Ω–∞–ª–∏—Å—è
**–°–∏–º–ø—Ç–æ–º:** –¢–∞–±–ª–∏—Ü—ñ users, roles –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ application.properties
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ Flyway –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
3. –í–∏–¥–∞–ª—ñ—Ç—å —Ç–∞–±–ª–∏—Ü—é `flyway_schema_history` —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å

### –ü—Ä–æ–±–ª–µ–º–∞ 4: 401 Unauthorized –∑–∞–º—ñ—Å—Ç—å —Ñ–æ—Ä–º–∏ –ª–æ–≥—ñ–Ω—É
**–°–∏–º–ø—Ç–æ–º:** JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞–º—ñ—Å—Ç—å HTML —Ñ–æ—Ä–º–∏

**–†—ñ—à–µ–Ω–Ω—è:**
- –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è API –∑–∞–ø–∏—Ç—ñ–≤
- –£ –±—Ä–∞—É–∑–µ—Ä—ñ –º–∞—î –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è —Ñ–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω—É
- –î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Basic Auth (`-u username:password`)

## –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

‚úÖ **–í–∏–∫–æ–Ω–∞–Ω–æ:**
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ Spring Security
- –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞–±–ª–∏—Ü—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ —Ä–æ–ª–µ–π
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–ª–µ–π
- –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

üî≤ **–ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ (—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è):**
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ RegistrationHandler –∑ –º–µ—Ç–æ–¥–æ–º —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
2. –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é username (—É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å)
3. –î–æ–¥–∞—Ç–∏ BCryptPasswordEncoder –¥–ª—è —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ HTML —Ñ–æ—Ä–º—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó (Freemarker template)
5. –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ ROLE_User
6. –î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é

–ü—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ—Ç–æ—á–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.

